---
title: "FJinsects"
author: "B"
date: "April 27, 2015"
output: html_document
---


<!---
use these command instead of the knit icon if you want the data and work loaded into the R workspace
  library(knitr)
  knit('FJinsects.rmd')
-->

To Do List
-------------------------

* plots of biomass and nums for Malaise and Barber traps with rainfall bars

Data Steps
-------------------------

* Load Packages

```{r setup, include=FALSE, echo=FALSE, cache=FALSE} 
  #########function to install (if needed) and load R packages by list
libs<-c("knitr","ggplot2","dplyr","wesanderson","plyr") #list of packages to load

installLoad<-function(pck){ #user defined function
    if(!pck%in%installed.packages()){install.packages(pck)}
    require(pck, character.only = TRUE)
  }
lapply(libs,function(x) installLoad(x))  #Load/Install require packages
```

* Load Data
* Data Definitions FJpop 
    - MO  (YearMo)
    - Session: (integer) Sequential numbering of months
    - NumsM (numeric) Malaise Trap: Number of individuals
    - BiomM (numeric) Malaise Trap: Biomass
    - NumsB (numeric) Barber Trap: Number of individuals
    - BiomB (numeric) Barber Trap: Biomass
 
```{r Data, include=FALSE, echo=FALSE, cache=FALSE} 
#load data
  FJ<-read.csv(file='Insects.csv') #paste the file name here

```

* Get coordinates for rainy year polygons (2003, 2006, 2011; May to May) by Session
    - xstart=c(1,31,91)
    - xend=c(7,43,103)
* Plot Monthly Values 

```{r PlotMo, include=FALSE, echo=FALSE, cache=FALSE}
#Start and end months of rain polygons
  rect<-data.frame(xstart=c(0,31,91),xend=c(7,43,103))
#function to create plots of monthly data
  PlotMo<-function(Yvar='NumsB',Title='Barber Trap Numbers/Month',Type='Log',Breaks=c(10,100,1000)){
    Data<-data.frame(X=FJ$Session,Y=FJ[,which(names(FJ)==Yvar)])    
    Out<-ggplot()+
      geom_rect(data = rect, aes(xmin = xstart, xmax = xend, 
                                 ymin = 0, ymax = Inf), alpha = 0.4)+
      geom_line(data=Data,aes(x=X,y=Y),colour='#2a2a2a',size=1.0) +
      geom_point(data=Data,aes(x=X,y=Y),size=4) +
      scale_x_continuous(limits=c(0,122),breaks=seq(2.5,122,by=12),labels=c(2004:2013),expand=c(.01,.01)) +
      theme(axis.title.y=element_text(face="bold",size=20),
          axis.text.x=element_text(angle=0,hjust=-.3,face="bold",size=20),
          axis.text.y=element_text(face="bold",size=14),
          axis.title.x=element_blank(),
          panel.border = element_rect(colour="black", fill=NA, size=2),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          panel.background = element_blank()) 
   if(Type=='Log'){ 
    Out<-Out + scale_y_log10(name=Title,breaks=Breaks) 
    }else{
      Out<-Out + scale_y_continuous(limits=c(0,max(Data$Y)),name=Title) 
    }
  print(Out)
  #send to file
    jpeg(filename=paste(Yvar,'_',Type,'.jpeg',sep=''),width=5*180,height=4*180) 
    print(Out)
    dev.off()
  }
PlotMo('NumsB','Barber Trap Numbers / Month','Log',c(10,100,1000))
PlotMo('NumsB','Barber Trap Numbers / Month','Linear')
PlotMo('NumsM','Malaise Trap Numbers / Month','Log',c(10,100,1000))
PlotMo('NumsM','Malaise Trap Numbers / Month','Linear')
PlotMo('BiomB','Barber Trap Biomass g / Month','Log',c(.1,1,10,100,1000))
PlotMo('BiomB','Barber Trap Biomass g / Month','Linear')
PlotMo('BiomM','Malaise Trap Biomass g / Month','Log',c(.1,1,5))
PlotMo('BiomM','Malaise Trap Biomass g / Month','Linear')
```

* Function to calculate means and standard errores (summarySE)


,breaks=c(10,100,1000)

```{r summarySE, include=FALSE, echo=FALSE, cache=FALSE}

#Function summarSE #http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/#Helper functions

## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
summarySE <- function(data=NULL, measurevar, groupvars=NULL, na.rm=FALSE,
                      conf.interval=.95, .drop=TRUE) {

    # New version of length which can handle NA's: if na.rm==T, don't count them
    length2 <- function (x, na.rm=FALSE) {
        if (na.rm) sum(!is.na(x))
        else       length(x)
    }

    # This does the summary. For each group's data frame, return a vector with
    # N, mean, and sd
    datac <- ddply(data, groupvars, .drop=.drop,
      .fun = function(xx, col) {
        c(N    = length2(xx[[col]], na.rm=na.rm),
          mean = mean   (xx[[col]], na.rm=na.rm),
          sd   = sd     (xx[[col]], na.rm=na.rm)
        )
      },
      measurevar
    )

    # Rename the "mean" column    
    datac <- rename(datac, c("mean" = measurevar))

    datac$se <- datac$sd / sqrt(datac$N)  # Calculate standard error of the mean

    # Confidence interval multiplier for standard error
    # Calculate t-statistic for confidence interval: 
    # e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
    ciMult <- qt(conf.interval/2 + .5, datac$N-1)
    datac$ci <- datac$se * ciMult

    return(datac)
}
```

* Add Month variable
* Aggregate data by month
* Plot values with standard errores

```{r plotMeans, include=FALSE, echo=FALSE, cache=FALSE}
#get Month
  FJ$Month<-as.numeric(substr(FJ$MO,5,6))
#Function to plot yearly means
  plotMeans<-function(Yvar='NumsB',Title='Mean Barber Trap Numbers / Month',Type='Log',Breaks=c(10,100,1000)){
    #get means and SE
      Means<-summarySE(FJ, measurevar=Yvar, groupvars=c("Month"),na.rm=TRUE)
    #plot data
      Data<-data.frame(X=Means$Month,Y=Means[,which(names(Means)==Yvar)],se=Means$se)   
    #error bars
      Data$Ymin=Data$Y-Data$se
      Data$Ymax=Data$Y+Data$se
    #Title
      Title<-paste(Title,' (',expression('\261'),'1 s.e.)',sep=)
    #plot data
      Out<-ggplot(Data, aes(x=X, y=Y)) + 
        geom_errorbar(aes(ymin=Ymin, ymax=Ymax), width=.1) +
        geom_line(size=1) +
        geom_point(size=4) +
        scale_x_continuous(limits=c(.9,12.1),breaks=c(1:12),labels=c('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'),expand=c(.01,.01)) +
      theme(axis.title.y=element_text(face="bold",size=20),
          axis.text.x=element_text(angle=0,hjust=0.5,face="bold",size=20),
          axis.text.y=element_text(face="bold",size=20),
          axis.title.x=element_blank(),
          panel.border = element_rect(colour="black", fill=NA, size=2),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          panel.background = element_blank()) 
   if(Type=='Log'){ 
    Out<-Out + scale_y_log10(limits=c(min(Data$Ymin),max(Data$Ymax)),name=Title,breaks=Breaks) 
    }else{
      Out<-Out + scale_y_continuous(limits=c(min(Data$Ymin),max(Data$Ymax)),name=Title) 
    }
  print(Out)
  #send to file
    jpeg(filename=paste('Mean_',Yvar,'_',Type,'.jpeg',sep=''),width=5*180,height=4*180) 
    print(Out)
    dev.off()
  }
plotMeans('NumsB','Mean Barber Trap Numbers / Month','Log',c(10,100,1000))
plotMeans('NumsB','Mean Barber Trap Numbers / Month','Linear')
plotMeans('NumsM','Mean Malaise Trap Numbers / Month','Log',c(10,100,1000))
plotMeans('NumsM','Mean Malaise Trap Numbers / Month','Linear')
plotMeans('BiomB','Mean Barber Trap Biomass g / Month','Log',c(.1,1,10,100,1000))
plotMeans('BiomB','Mean Barber Trap Biomass g / Month','Linear')
plotMeans('BiomM','Mean Malaise Trap Biomass g / Month','Log',c(1,2,3))
plotMeans('BiomM','Mean Malaise Trap Biomass g / Month','Linear')

